@model IEnumerable<Marimon.Models.Autoparte>

@{
    ViewData["Title"] = "Repuestos y Llantas";
    Layout = "_LayoutAdmin";
    
}


<div class="container py-4">
    <!-- Encabezado con imagen y texto -->
    <div class="row align-items-center mb-4">
        <div class="col-md-6 text-center">
            <img src="~/images/auto.png" alt="Auto" class="img-fluid" />
        </div>
        <div class="col-md-6">
            <h2 class="fw-bold">Repuestos y Llantas</h2>
            <p>
                Contamos con una amplia variedad de autopartes y llantas para tu vehículo.
                Consulta la lista y encuentra lo que necesitas.
            </p>
        </div>
    </div>

    <!-- Botón para abrir el modal de registro -->
    <div class="mb-3">
        <button  data-bs-toggle="modal" data-bs-target="#registerModal">
            Registrar nueva autoparte
        </button>
    </div>


    
    <!-- Modal de Registro (Carga el formulario de la otra vista) -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">Registrar nueva autoparte</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalContent">
                    <!-- Aquí se cargará el formulario de la vista separada -->
                </div>
            </div>
        </div>
    </div>

    

    <!-- Modal para editar autoparte -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Editar autoparte</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" id="modalContentEdit">
                    <!-- Aquí se cargará el formulario de edición -->
                </div>
            </div>
        </div>
    </div>



    <!-- Tabla de autopartes -->
    <div class="table-responsive">
        <table class="table table-bordered text-center align-middle">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Especificaciones</th>
                    <th>Precio (S/)</th>
                    <th>Categoría</th>
                    <th>Imagen</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.aut_id</td>
                        <td>@item.aut_nombre</td>
                        <td>@item.aut_descripcion</td>
                        <td>@item.aut_especificacion</td>
                        <td>@item.aut_precio.ToString("F2")</td>
                        <td>@item.Categoria?.cat_nombre</td>
                        <td>
                            @if (!string.IsNullOrEmpty(item.aut_imagen))
                            {
                                <img src="@item.aut_imagen" alt="Imagen" class="img-thumbnail" style="width: 60px; height: 60px;" />
                            }
                            else
                            {
                                <span class="text-muted">Sin imagen</span>
                            }
                        </td>
                        <td>
                            <a href="#" onclick="event.preventDefault(); loadEditModal('@item.aut_id');">
                                Modificar
                            </a>
                            <form asp-action="Eliminar" asp-controller="Admin" asp-route-id="@item.aut_id" method="post" onsubmit="return confirm('¿Estás seguro de eliminar esta autoparte?');">
                                <button type="submit">Eliminar</button>
                            </form>
                     </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Este script carga el formulario desde otra página al abrir el modal de registro
        $('#registerModal').on('show.bs.modal', function (e) {
            $.get('@Url.Action("Create", "Admin")', function (data) {
                $('#modalContent').html(data); // Inserta el contenido en el modal
            });
        });

        // Este script carga el formulario desde otra página al abrir el modal de edición
        function loadEditModal(aut_id) {
            $.get('/Admin/Editar/' + aut_id, function (data) {
                $('#modalContentEdit').html(data);
                $('#editModal').modal('show');
            });
        }
    </script>

}

