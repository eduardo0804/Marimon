<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Marimon</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/Marimon.styles.css" asp-append-version="true" />

    <!-- Icono que se muestra en la web -->
    <link rel="shortcut icon" href="/images/logo_icon.png">

    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
    @RenderSection("Styles", required: false)
</head>
<style>
    body {
        display: flex;
        flex-direction: column;
        min-height: 100%;
        font-family: "Nunito";
    }

    html,
    body {
        height: 100%;
    }

    .bungee-spice-regular {
        font-family: "Bungee Spice", sans-serif;
        font-weight: 400;
        font-style: normal;
        font-size: 36px;
    }

    .nunito-regular {
        font-family: 'Nunito', sans-serif;
        font-weight: 400;
    }

    .nunito-semibold {
        font-family: 'Nunito', sans-serif;
        font-weight: 600;
    }

    .nunito-bold {
        font-family: 'Nunito', sans-serif;
        font-weight: 700;
    }

    .nunito-extrabold {
        font-family: 'Nunito', sans-serif;
        font-weight: 800;
    }
</style>

<body>
    <header>
        <div class="contenedor-menu">
            <!-- Toggle para menú móvil a la izquierda -->
            <input type="radio" name="slider" id="menu-btn">
            <input type="radio" name="slider" id="close-btn">
            <label for="menu-btn" class="menu-btn botones"><i class="fa-solid fa-bars"></i></label>
            <label for="close-btn" class="close-btn botones"><i class="fa-solid fa-xmark"></i></label>

            <!-- Logo centrado -->
            <div class="logo-contenedor">
                <a asp-area="" asp-controller="Home" asp-action="Index" class="logo"><img
                        src="~/images/logo_marimon.png" alt="Logo" style="width: 140px;"></a>
            </div>

            <!-- Carrito a la derecha -->
            <div class="carrito-movil-container">
                <a asp-controller="Carrito" asp-action="Index" class="cart-icon-movil"><i
                        class="fa-solid fa-cart-shopping"></i></a>
            </div>

            <!-- Menú principal centrado -->
            <nav class="primer_menu">
                <a asp-area="" asp-controller="Home" asp-action="Index">INICIO</a>
                <!-- Dropdown SERVICIOS -->
                <div class="dropdown">
                    <a asp-area="" asp-controller="Servicios" asp-action="Index" class="desktop-item">SERVICIOS</a>
                    <ul class="drop-menu">
                        @await Component.InvokeAsync("ServiciosMenu")
                    </ul>
                </div>
                <a asp-area="" asp-controller="Catalogo" asp-action="Index">CATÁLOGO</a>
                <a asp-area="" asp-controller="Nosotros" asp-action="Index">NOSOTROS</a>
            </nav>

            <!-- Menú secundario alineado a la derecha -->
            <partial name="_LoginPartial" />

            <!-- Menú móvil -->
            <nav class="movil_menu">
                <label for="close-btn" class="botones close-btn-inside"><i class="fa-solid fa-xmark"></i></label>

                <a asp-area="" asp-controller="Home" asp-action="Index">INICIO</a>
                <!-- Dropdown SERVICIOS móvil -->
                <div class="dropdown-movil">
                    <input type="checkbox" id="showServicios-movil">
                    <label for="showServicios-movil">SERVICIOS <i class="fa-solid fa-chevron-down"></i></label>
                    <ul class="drop-menu-movil">
                        @await Component.InvokeAsync("ServiciosMenu")
                    </ul>
                </div>
                <a asp-area="" asp-controller="Catalogo" asp-action="Index">CATÁLOGO</a>
                <a asp-area="" asp-controller="Nosotros" asp-action="Index">NOSOTROS</a>

                <!-- Dropdown Iniciar Sesión móvil -->
                <partial name="_LoginPartial_Movil" />
            </nav>
        </div>
    </header>

    <div class="container">
        <main role="main" class="p-0 m-0">
            @RenderBody()
        </main>
    </div>


    <partial name="_Whatsapp" />


    <footer>
        <div class="contenido-footer">
            <!-- Parte superior: logo y redes -->
            <div class="top">
                <div class="logo-details">
                    <a asp-area="" asp-controller="Home" asp-action="Index">
                        <img style="width: 140px;" src="/images/logo_marimon.png" alt="Logo Marimon">
                    </a>
                </div>
                <div class="media-icons-wrapper">
                    <span class="media-label">Síguenos en:</span>
                    <div class="media-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>

            <!-- Parte media: contacto -->
            <div class="middle">
                <div class="contact-item">
                    <div class="icono-circle">
                        <i class="fas fa-envelope icono"></i>
                    </div>
                    <div>
                        <strong>Email:</strong><br>
                        automotrizmarimon@gmail.com
                    </div>
                </div>
                <div class="contact-item">
                    <div class="icono-circle">
                        <i class="fas fa-phone icono"></i>
                    </div>
                    <div>
                        <strong>Teléfono:</strong><br>
                        +51 994 061 278
                        <br>
                        +51 995 256 967
                    </div>
                </div>
                <div class="contact-item">
                    <div class="icono-circle">
                        <i class="fas fa-map-marker-alt icono"></i>
                    </div>
                    <div>
                        <strong>Dirección:</strong><br>
                        Jr. Gral. Felipe Santiago Salaverry 44, Lima 15022
                    </div>
                </div>
            </div>
        </div>

        <!-- Parte inferior -->
        <div class="bottom">
            <div class="bottom-content">
                <div>Copyright &#169; 2025 <a asp-controller="Home" asp-action="Index"
                        style="color: white; text-decoration: none;">Marimon</a></div>
                <div><a href="@Url.Action("Terminos", "Home")">Términos y Condiciones</a></div>
                <div><a href="#" id="linkReclamacion">Libro de Reclamaciones</a></div>
                <div><a href="@Url.Action("Privacy", "Home")">Política y Privacidad</a></div>
                <div>Developed by <strong>G03 - ISW2</strong></div>
            </div>
        </div>
    </footer>
    <div id="carritoSide">
        <span>Cargando carrito...</span>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch('/Carrito/Side')
                .then(res => res.text())
                .then(html => {
                    document.getElementById("carritoSide").innerHTML = html;
                });
        });
    </script>
    <script>
        // File preview functionality
        document.getElementById('comprobanteFile').addEventListener('change', function (e) {
            const preview = document.getElementById('imagePreview');
            const file = e.target.files[0];
            if (file) {
                // Validate file size
                if (file.size > 5 * 1024 * 1024) {
                    alert('El archivo es demasiado grande. Por favor, sube una imagen de menos de 5MB.');
                    this.value = '';
                    preview.style.display = 'none';
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (event) {
                    preview.src = event.target.result;
                    preview.style.display = 'block';
                    preview.classList.add('animate__animated', 'animate__fadeIn');
                }
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        });

        // Form validation
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                var forms = document.getElementsByClassName('needs-validation');
                Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();

                            // Check if terms checkbox is causing validation error
                            if (!document.getElementById('aceptaTerminos').checked) {
                                document.querySelector('.terms-container').classList.add('shake');
                                setTimeout(() => {
                                    document.querySelector('.terms-container').classList.remove('shake');
                                }, 600);
                            }

                            // Animate the form shake if invalid
                            form.classList.add('animate__animated', 'animate__shakeX');
                            setTimeout(() => {
                                form.classList.remove('animate__animated', 'animate__shakeX');
                            }, 1000);
                        } else {
                            // Show loading spinner when form is valid and submitted
                            document.querySelector('.payment-progress').style.display = 'flex';
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        // Copy account number to clipboard
        document.getElementById('accountNumber').addEventListener('click', function () {
            const copyText = this.textContent;
            navigator.clipboard.writeText(copyText).then(() => {
                const copyMsg = document.querySelector('.copy-msg');
                copyMsg.style.display = 'inline';
                this.classList.add('copied');

                setTimeout(() => {
                    copyMsg.style.display = 'none';
                    this.classList.remove('copied');
                }, 2000);
            });
        });

        // Custom checkbox functionality
        document.getElementById('customCheckbox').addEventListener('click', function () {
            const checkbox = document.getElementById('aceptaTerminos');
            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                this.classList.add('checked');
            } else {
                this.classList.remove('checked');
            }
        });

        // Add ripple effect to custom checkbox
        let ripple = document.createElement('span');
        ripple.classList.add('ripple');
        document.getElementById('customCheckbox').appendChild(ripple);

        document.getElementById('customCheckbox').addEventListener('mousedown', function (e) {
            const x = e.clientX - e.target.getBoundingClientRect().left;
            const y = e.clientY - e.target.getBoundingClientRect().top;

            ripple.style.left = `${x}px`;
            ripple.style.top = `${y}px`;
            ripple.classList.add('animate');

            setTimeout(() => {
                ripple.classList.remove('animate');
            }, 500);
        });

        // Add smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        function actualizarSidebarCarrito() {
            fetch('/Carrito/Side')
                .then(response => response.text())
                .then(html => {
                    // Crear un elemento temporal para parsear el HTML
                    const temp = document.createElement('div');
                    temp.innerHTML = html;

                    // Extraer el contenido del offcanvas del HTML
                    const nuevoOffcanvas = temp.querySelector('#offcanvasCarrito');

                    // Obtener el offcanvas actual
                    const offcanvasActual = document.querySelector('#offcanvasCarrito');

                    if (nuevoOffcanvas && offcanvasActual) {
                        // Reemplazar solo el contenido interno (preservando el offcanvas abierto)
                        offcanvasActual.querySelector('.offcanvas-header').innerHTML =
                            nuevoOffcanvas.querySelector('.offcanvas-header').innerHTML;

                        offcanvasActual.querySelector('.offcanvas-body').innerHTML =
                            nuevoOffcanvas.querySelector('.offcanvas-body').innerHTML;

                        // Actualizar el contador en el navbar (si existe)
                        const cantidadTotal = temp.querySelector('#offcanvasCarritoLabel')?.textContent.match(/\((\d+)\)/)?.[1] || "0";
                        const contadorCarrito = document.getElementById('contador-carrito');
                        if (contadorCarrito) {
                            contadorCarrito.textContent = cantidadTotal;
                            contadorCarrito.style.display = cantidadTotal === "0" ? 'none' : 'inline-block';
                        }
                    }
                })
                .catch(error => console.error('Error al actualizar el sidebar del carrito:', error));
        }

        // Para mostrar el offcanvas después de añadir un producto
        function mostrarSidebarCarrito() {
            const offcanvasCarrito = document.getElementById('offcanvasCarrito');
            if (offcanvasCarrito) {
                const offcanvasInstance = bootstrap.Offcanvas.getInstance(offcanvasCarrito) ||
                    new bootstrap.Offcanvas(offcanvasCarrito);
                offcanvasInstance.show();
            }
        }
        // Stop QR pulse animation after 10 seconds
        setTimeout(() => {
            document.querySelector('.qr-box').classList.remove('pulse');
        }, 10000);
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const link = document.getElementById("linkReclamacion");
            if (link) {
                link.addEventListener("click", function (e) {
                    e.preventDefault();
                    fetch("/api/esta-logueado")
                        .then(response => response.json())
                        .then(data => {
                            if (data.logueado) {
                                window.location.href = "/Reclamacion";
                            } else {
                                const modal = new bootstrap.Modal(document.getElementById("modalLoginRequired"));
                                modal.show();
                            }
                        });
                });
            }
        });
    </script>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <!--<script src="~/js/site.js" asp-append-version="true"></script> -->
    @await RenderSectionAsync("Scripts", required: false)
    <!-- Modal para login requerido -->
    <div class="modal fade" id="modalLoginRequired" tabindex="-1" aria-labelledby="modalLoginLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Acceso restringido</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body">
                    Para acceder al libro de reclamaciones necesitas iniciar sesión.
                </div>
                <div class="modal-footer">
                    <a class="btn btn-primary" href="/Identity/Account/Login">Iniciar sesión</a>
                </div>
            </div>
        </div>
    </div>

</body>

</html>